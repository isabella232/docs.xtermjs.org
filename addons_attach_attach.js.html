<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addons/attach/attach.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-xterm_src_xterm.html">xterm/src/xterm</a><ul class='methods'><li data-type='method'><a href="module-xterm_src_xterm.html#.bindBlur">bindBlur</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.bindCopy">bindCopy</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.bindCut">bindCut</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.bindDrop">bindDrop</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.bindFocus">bindFocus</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.bindKeys">bindKeys</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.bindPaste">bindPaste</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.click">click</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.loadAddon">loadAddon</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#.prepareCopiedTextForClipboard">prepareCopiedTextForClipboard</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#bell">bell</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#bindMouse">bindMouse</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#blur">blur</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#clearSelection">clearSelection</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#cursorForwardTab">cursorForwardTab</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#cursorUp">cursorUp</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#destroy">destroy</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#eraseAttr">eraseAttr</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#error">error</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#evaluateKeyEscapeSequence">evaluateKeyEscapeSequence</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#focus">focus</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#index">index</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#initGlobal">initGlobal</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#insertChars">insertChars</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#insertRow">insertRow</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#keyDown">keyDown</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#keyPress">keyPress</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#leaseContentEditable">leaseContentEditable</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#log">log</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#maxRange">maxRange</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#open">open</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#refresh">refresh</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#resize">resize</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#scroll">scroll</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#scrollDisp">scrollDisp</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#send">send</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#setgCharset">setgCharset</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#setgLevel">setgLevel</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#showCursor">showCursor</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#updateRange">updateRange</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#write">write</a></li><li data-type='method'><a href="module-xterm_src_xterm.html#writeln">writeln</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-xterm_addons_attach_attach.html">xterm/addons/attach/attach</a><ul class='methods'><li data-type='method'><a href="module-xterm_addons_attach_attach.html#.attach">attach</a></li><li data-type='method'><a href="module-xterm_addons_attach_attach.html#.detach">detach</a></li></ul></li><li><a href="module-xterm_addons_fit_fit.html">xterm/addons/fit/fit</a></li><li><a href="module-xterm_addons_linkify_linkify.html">xterm/addons/linkify/linkify</a><ul class='methods'><li data-type='method'><a href="module-xterm_addons_linkify_linkify.html#.findLinkMatch">findLinkMatch</a></li><li data-type='method'><a href="module-xterm_addons_linkify_linkify.html#.linkify">linkify</a></li><li data-type='method'><a href="module-xterm_addons_linkify_linkify.html#.linkifyTerminalLine">linkifyTerminalLine</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="module-xterm_addons_linkify_linkify.html#~event:linkify">linkify</a></li><li><a href="module-xterm_addons_linkify_linkify.html#~event:linkify:line">linkify:line</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">addons/attach/attach.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * Implements the attach method, that
 * attaches the terminal to a WebSocket stream.
 *
 * The bidirectional argument indicates, whether the terminal should
 * send data to the socket as well and is true, by default.
 */

(function (attach) {
  if (typeof exports === 'object' &amp;&amp; typeof module === 'object') {
    /*
     * CommonJS environment
     */
    module.exports = attach(require('../../src/xterm'));
  } else if (typeof define == 'function') {
    /*
     * Require.js is available
     */
    define(['../../src/xterm'], attach);
  } else {
    /*
     * Plain browser environment
     */
    attach(this.Xterm);
  }
})(function (Xterm) {
  'use strict';

  /**
   * This module provides methods for attaching a terminal to a WebSocket
   * stream.
   *
   * @module xterm/addons/attach/attach
   */
  var exports = {};

  /**
   * Attaches the given terminal to the given socket.
   *
   * @param {Xterm} term - The terminal to be attached to the given socket.
   * @param {WebSocket} socket - The socket to attach the current terminal.
   * @param {boolean} bidirectional - Whether the terminal should send data
   *                                  to the socket as well.
   * @param {boolean} buffered - Whether the rendering of incoming data
   *                             should happen instantly or at a maximum
   *                             frequency of 1 rendering per 10ms.
   */
  exports.attach = function (term, socket, bidirectional, buffered) {
    bidirectional = (typeof bidirectional == 'undefined') ? true : bidirectional;
    term.socket = socket;

    term._flushBuffer = function () {
      term.write(term._attachSocketBuffer);
      term._attachSocketBuffer = null;
      clearTimeout(term._attachSocketBufferTimer);
      term._attachSocketBufferTimer = null;
    };

    term._pushToBuffer = function (data) {
      if (term._attachSocketBuffer) {
        term._attachSocketBuffer += data;
      } else {
        term._attachSocketBuffer = data;
        setTimeout(term._flushBuffer, 10);
      }
    };

    term._getMessage = function (ev) {
      if (buffered) {
        term._pushToBuffer(ev.data);
      } else {
        term.write(ev.data);
      }
    };

    term._sendData = function (data) {
      socket.send(data);
    };

    socket.addEventListener('message', term._getMessage);

    if (bidirectional) {
      term.on('data', term._sendData);
    }

    socket.addEventListener('close', term.detach.bind(term, socket));
    socket.addEventListener('error', term.detach.bind(term, socket));
  };

  /**
   * Detaches the given terminal from the given socket
   *
   * @param {Xterm} term - The terminal to be detached from the given socket.
   * @param {WebSocket} socket - The socket from which to detach the current
   *                             terminal.
   */
  exports.detach = function (term, socket) {
    term.off('data', term._sendData);

    socket = (typeof socket == 'undefined') ? term.socket : socket;

    if (socket) {
      socket.removeEventListener('message', term._getMessage);
    }

    delete term.socket;
  };

  /**
   * Attaches the current terminal to the given socket
   *
   * @param {WebSocket} socket - The socket to attach the current terminal.
   * @param {boolean} bidirectional - Whether the terminal should send data
   *                                  to the socket as well.
   * @param {boolean} buffered - Whether the rendering of incoming data
   *                             should happen instantly or at a maximum
   *                             frequency of 1 rendering per 10ms.
   */
  Xterm.prototype.attach = function (socket, bidirectional, buffered) {
    return exports.attach(this, socket, bidirectional, buffered);
  };

  /**
   * Detaches the current terminal from the given socket.
   *
   * @param {WebSocket} socket - The socket from which to detach the current
   *                             terminal.
   */
  Xterm.prototype.detach = function (socket) {
    return exports.detach(this, socket);
  };

  return exports;
});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Jul 11 2016 22:33:45 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
